---
title: Custom Nix Classes
description: Create new Nix configuration classes with den._.forward.
---

import { Aside } from '@astrojs/starlight/components';

<Aside title="Use the Source, Luke" icon="github">[`modules/aspects/provides/forward.nix`](https://github.com/vic/den/blob/main/modules/aspects/provides/forward.nix) Â· [CI tests](https://github.com/vic/den/blob/main/templates/ci/modules/forward.nix)</Aside>

## What Are Custom Classes?

Den natively supports `nixos`, `darwin`, and `homeManager` classes. But you
can create your own classes that forward their settings into any target
submodule. This is exactly how Home-Manager integration works internally.

## The forward Battery

`den._.forward` creates an aspect that takes configs from a source class
and inserts them into a target class at a specified path.

## Example: Custom Class to NixOS

Forward a new `hjem` class into NixOS top-level:

```nix
{ den, lib, ... }:
let
  hjem = { host }: { class, aspect-chain }:
    den._.forward {
      each = host.users;
      fromClass = user: "hjem";
      intoClass = user: class;
      intoPath = user: [ "hjem" "users" user.userName ]
      fromAspect = user: den.aspects.${user.aspect};
    };
in {
  # host forwards user hjem modules into nixos level.
  den.aspects.igloo = { includes = [ hjem ]; };

  # user aspect has hjem class
  den.aspects.tux.hjem  = { ... };
}
```


## How Home-Manager Uses Forward

Den's Home-Manager integration is built on `forward`:

```nix
den._.forward {
  each = lib.singleton true;
  fromClass = _: "homeManager";
  intoClass = _: host.class;
  intoPath = _: [ "home-manager" "users" user.userName ];
  fromAspect = _: userAspect;
}
```

This takes all `homeManager` class configs from user aspects and inserts them
into `home-manager.users.<name>` on the host's OS configuration.

## Use Cases

- **User environments**: Forward a `user` class into `users.users.<name>`
- **Containerization**: Forward a `container` class into systemd-nspawn configs
- **VM configs**: Forward a `vm` class into microvm or QEMU settings
- **Custom tools**: Forward into any Nix-configurable system (NixVim, etc.)

## Creating Your Own

The `forward` function parameters:

| Parameter | Description |
|-----------|-------------|
| `each` | List of items to iterate over |
| `fromClass` | Source class name (string) |
| `intoClass` | Target class name (string) |
| `intoPath` | Attribute path in target (list of strings) |
| `fromAspect` | Source aspect to read from |
