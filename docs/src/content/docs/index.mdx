---
title: Context-aware Dendritic Nix
description: Context-driven, aspect-oriented, cross-class Nix configurations.
template: splash
hero:
  tagline: Context-driven, aspect-oriented, cross-class Nix configurations
  image:
    html: |
      <img width="400" height="400" src="https://github.com/user-attachments/assets/af9c9bca-ab8b-4682-8678-31a70d510bbb" />
  actions:
    - text: NixOS Framework
      link: /tutorials/getting-started/
      icon: right-arrow
    - text: Pure Nix Library
      link: /explanation/library-vs-framework
      variant: minimal
    - text: Why Den?
      link: /motivation/
      variant: minimal
    - text: Source Code
      link: https://github.com/vic/den
      icon: github
      variant: minimal
---

import { Card, CardGrid } from '@astrojs/starlight/components';


At its core, Den is a **library** for activating Nix-modules configuration aspects via context transformations.  

On top of the library, Den provides a **framework** for the common case
of NixOS/Darwin/Home-Manager.  

Den embraces to your Nix choices and does not impose itself. All parts of Den are optional and replaceable.

## Two Core Principles

Den builds on [flake-aspects](https://github.com/vic/flake-aspects)' **parametric aspects**,
and provides a declarative **context-pipeline** as cutting-points for these aspects.

<CardGrid>
  <Card title="Context Transformation" icon="random">
    Data flows through a declarative [pipeline](/explanation/context-pipeline/) of
    [contexts](/explanation/context-system/). Each stage enriches the context — from
    host definitions through user enumeration to domain-specific requirements.
  </Card>
  <Card title="Context-Aware Aspects" icon="puzzle">
    [Aspects](/explanation/aspects/) are composable bundles of cross-class Nix configs.
    They inspect context to produce conditional, [parametric](/explanation/parametric/)
    configurations — and are activated by a matching context.
  </Card>
</CardGrid>


### 1. Context Transformation

Data flows through a declarative pipeline. You declare the entities (data) that exists in your universe, Den transforms them into progressively richer contexts to which aspects are attached, providing configuration for each context:

```mermaid
graph LR
  H["den.ctx.host {host}"] --> U["den.ctx.user {host, user} (for each user)"]
  U --> HM["aspect provides homeManager/hjeim class"]
  H --> OS["aspect provides nixos/darwin class"]
```

Each stage of the pipeline is a [**context type**](/explanation/context-system/) defined in `den.ctx`. Context types
declare how to find [aspects](/explanation/aspects/), how to transform into other contexts, and which
[parametric](/explanation/parametric/) includes to activate.

### 2. Context-Aware Aspects

Aspects are composable bundles of multi-class Nix modules that inspect their context parameters to decide
what to produce. A function taking `{ host, ... }` only runs when a host context
exists. A function taking `{ host, user, ... }` runs once per user on each host.

Functions that require parameters not present in the current context are
not included. Den introduces pattern matching on context shape.



## Den as a Library

```nix
# Use Den API -- Build the dependencies graph for NixOS hosts
aspect = den.ctx.host { host = den.hosts.x86_64-linux.igloo; };

# Use flake-aspects API -- We enter the NixOS domain by resolving for the "nixos" class.
nixosModule = aspect.resolve { class = "nixos"; };

# Use NixOS API -- Instantiate using nixosSystem with the resolved module.
nixosConfigurations.igloo = lib.nixosSystem { modules = [ nixosModule ]; };
```

This same pattern works for any class — create your own context transformation graphs and replace `"nixos"` with
`"darwin"`, `"systemManager"`, `"terranix"` or any custom class name.


<CardGrid>
  <Card title="Any Nix Class" icon="nix">
    NixOS, Darwin, Home-Manager, Terraform, NixVim — Den
    works with [anything configurable through Nix](/explanation/library-vs-framework/).
  </Card>
  <Card title="Context Pipeline" icon="right-arrow">
    Define custom [context types](/reference/ctx/) with `den.ctx`. Declarative
    [transformations](/explanation/context-pipeline/) propagate data through your config graph.
  </Card>
  <Card title="No Lock-in" icon="open-book">
    Works [with flakes, without flakes](/guides/no-flakes/), with flake-parts, or
    standalone. Den plays well with your existing Nix choices. And integrates with your existing infra.
  </Card>
  <Card title="Sharable Aspects" icon="star">
    Re-usablity is one of the goals of Den. Allowing people to create truly-generic configuration modules.
    [Namespaces](/guides/namespaces/) let you publish and consume aspect libraries
    across repositories and flakes.
  </Card>
</CardGrid>

## Den as a Framework

```nix
# use in flake-parts or any lib.evalModules where den.nixModule is imported
{ den, ... }: {

  # declare your hosts, users and homes
  den.x86_64-linux.hosts.igloo.users.tux = { };

  # attach configurations via aspects
  den.igloo.nixos.networking.hostName = "warm-home";

  # user aspects can configure its home and host environment
  den.tux.homeManager = { pkgs, ... }: { home.packages = [ pkgs.cowsay ]; };
  den.tux.nixos.users.users.tux.desscription = "cute pinguin";

  # include other re-usable aspects of yours or den batteries
  den.tux.includes = [ (den.provides.user-shell "fish") ];

  # generic config for all hosts, users, homes.
  den.default.nixos.system.stateVersion = "25.11";
  den.default.homeManager.home.stateVersion = "25.11";
  den.default.includes [ den._.inputs' ];

}
```

<CardGrid>
  <Card title="Declare Systems" icon="laptop">
    One-liner [host and user](/guides/declare-hosts/) definitions with
    [freeform schemas](/reference/schema/). NixOS, Darwin, Home-Manager —
    all from a single source.
  </Card>
  <Card title="Bidirectional" icon="right-arrow">
    Hosts configure their users. Users contribute to their
    hosts. [Aspects flow in both directions](/guides/bidirectional/) automatically.
  </Card>
  <Card title="Batteries Included" icon="add-document">
    Opt-in [aspects for common tasks](/guides/batteries/): define-user, primary-user,
    user-shell, unfree packages, import-tree, and more.
  </Card>
  <Card title="Community" icon="heart">
    Share configurations through [namespaces](/guides/namespaces/). Real-world setups
    and a growing ecosystem at [denful](https://github.com/vic/denful) (wip).
  </Card>
</CardGrid>


Feel free to to **explore** the [codebase](https://github.com/vic/den), particularly our [included batteries](https://github.com/vic/den/tree/main/modules/aspects/provides) and [tests](https://github.com/vic/den/tree/main/templates/ci/modules/features) that serve as examples.
